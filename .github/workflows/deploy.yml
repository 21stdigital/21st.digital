name: Deploy

on:
  push:
    branches:
      - main
  release:
    types:
      - published

jobs:
  forge_deploy_staging:
    if: github.ref == 'refs/heads/main'
    name: Laravel Forge Deploy to Staging
    runs-on: ubuntu-latest
    environment: staging
    concurrency:
      group: staging
      cancel-in-progress: true
    steps:
      - name: Deploy to Laravel Forge (Staging)
        uses: jbrooksuk/laravel-forge-action@v1.0.4
        with:
          api_key: ${{ secrets.FORGE_API_KEY }}
          server_id: ${{ secrets.FORGE_SERVER_ID }}
          site_id: ${{ secrets.FORGE_SITE_ID }}

  forge_deploy_production:
    if: github.event_name == 'release' && github.event.action == 'published'
    name: Laravel Forge Deploy to Production
    runs-on: ubuntu-latest
    environment: production
    concurrency:
      group: production
      cancel-in-progress: true
    steps:
      - name: Deploy to Laravel Forge (Production)
        uses: jbrooksuk/laravel-forge-action@v1.0.4
        with:
          api_key: ${{ secrets.FORGE_API_KEY }}
          server_id: ${{ secrets.FORGE_SERVER_ID }}
          site_id: ${{ secrets.FORGE_SITE_ID }}
